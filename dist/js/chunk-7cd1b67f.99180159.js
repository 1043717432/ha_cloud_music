(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7cd1b67f"],{"0908":function(t,e,i){"use strict";var r=i("5482"),n=i.n(r);n.a},"0fea":function(t,e,i){},"1a26":function(t,e,i){"use strict";var r=i("69ec"),n=i.n(r);n.a},2262:function(t,e,i){t.exports=i.p+"img/player_cover.373e0739.png"},"34a3":function(t,e,i){"use strict";var r=i("a013"),n=i("db4b"),s=i("b146"),c=i("c481"),a=i("b0f4"),o=i("35dd"),u=Math.max,l=Math.min,d=Math.floor,m=/\$([$&`']|\d\d?|<[^>]*>)/g,h=/\$([$&`']|\d\d?)/g,v=function(t){return void 0===t?t:String(t)};i("629c")("replace",2,function(t,e,i,f){return[function(r,n){var s=t(this),c=void 0==r?void 0:r[e];return void 0!==c?c.call(r,s,n):i.call(String(s),r,n)},function(t,e){var n=f(i,t,this,e);if(n.done)return n.value;var d=r(t),m=String(this),h="function"===typeof e;h||(e=String(e));var g=d.global;if(g){var y=d.unicode;d.lastIndex=0}var b=[];while(1){var x=o(d,m);if(null===x)break;if(b.push(x),!g)break;var M=String(x[0]);""===M&&(d.lastIndex=a(m,s(d.lastIndex),y))}for(var C="",P=0,_=0;_<b.length;_++){x=b[_];for(var w=String(x[0]),k=u(l(c(x.index),m.length),0),T=[],I=1;I<x.length;I++)T.push(v(x[I]));var $=x.groups;if(h){var E=[w].concat(T,k,m);void 0!==$&&E.push($);var S=String(e.apply(void 0,E))}else S=p(w,m,k,T,$,e);k>=P&&(C+=m.slice(P,k)+S,P=k+w.length)}return C+m.slice(P)}];function p(t,e,r,s,c,a){var o=r+t.length,u=s.length,l=h;return void 0!==c&&(c=n(c),l=m),i.call(a,l,function(i,n){var a;switch(n.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(o);case"<":a=c[n.slice(1,-1)];break;default:var l=+n;if(0===l)return i;if(l>u){var m=d(l/10);return 0===m?i:m<=u?void 0===s[m-1]?n.charAt(1):s[m-1]+n.charAt(1):i}a=s[l-1]}return void 0===a?"":a})}})},"4e6a":function(t,e,i){"use strict";var r=i("c28c"),n=i.n(r);n.a},5482:function(t,e,i){},"69ec":function(t,e,i){},"7bc1":function(t,e,i){"use strict";var r=i("22e9"),n=i("a013"),s=i("0d5f"),c=i("b0f4"),a=i("b146"),o=i("35dd"),u=i("1f98"),l=i("b6f1"),d=Math.min,m=[].push,h="split",v="length",f="lastIndex",p=4294967295,g=!l(function(){RegExp(p,"y")});i("629c")("split",2,function(t,e,i,l){var y;return y="c"=="abbc"[h](/(b)*/)[1]||4!="test"[h](/(?:)/,-1)[v]||2!="ab"[h](/(?:ab)*/)[v]||4!="."[h](/(.?)(.?)/)[v]||"."[h](/()()/)[v]>1||""[h](/.?/)[v]?function(t,e){var n=String(this);if(void 0===t&&0===e)return[];if(!r(t))return i.call(n,t,e);var s,c,a,o=[],l=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),d=0,h=void 0===e?p:e>>>0,g=new RegExp(t.source,l+"g");while(s=u.call(g,n)){if(c=g[f],c>d&&(o.push(n.slice(d,s.index)),s[v]>1&&s.index<n[v]&&m.apply(o,s.slice(1)),a=s[0][v],d=c,o[v]>=h))break;g[f]===s.index&&g[f]++}return d===n[v]?!a&&g.test("")||o.push(""):o.push(n.slice(d)),o[v]>h?o.slice(0,h):o}:"0"[h](void 0,0)[v]?function(t,e){return void 0===t&&0===e?[]:i.call(this,t,e)}:i,[function(i,r){var n=t(this),s=void 0==i?void 0:i[e];return void 0!==s?s.call(i,n,r):y.call(String(n),i,r)},function(t,e){var r=l(y,t,this,e,y!==i);if(r.done)return r.value;var u=n(t),m=String(this),h=s(u,RegExp),v=u.unicode,f=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(g?"y":"g"),b=new h(g?u:"^(?:"+u.source+")",f),x=void 0===e?p:e>>>0;if(0===x)return[];if(0===m.length)return null===o(b,m)?[m]:[];var M=0,C=0,P=[];while(C<m.length){b.lastIndex=g?C:0;var _,w=o(b,g?m:m.slice(C));if(null===w||(_=d(a(b.lastIndex+(g?0:C)),m.length))===M)C=c(m,C,v);else{if(P.push(m.slice(M,C)),P.length===x)return P;for(var k=1;k<=w.length-1;k++)if(P.push(w[k]),P.length===x)return P;C=M=_}}return P.push(m.slice(M)),P}]})},b3e4:function(t,e,i){"use strict";var r=i("0fea"),n=i.n(r);n.a},b76b:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"music"},[i("div",{staticClass:"music-content"},[i("div",{staticClass:"music-left"},[i("music-btn"),i("keep-alive",[t.$route.meta.keepAlive?i("router-view",{staticClass:"music-list"}):t._e()],1),t.$route.meta.keepAlive?t._e():i("router-view",{key:t.$route.path,staticClass:"music-list"})],1),i("lyric",{staticClass:"music-right",attrs:{lyric:t.lyric,nolyric:t.nolyric,lyricIndex:t.lyricIndex}})],1),i("div",{staticClass:"music-bar",class:{disable:!t.musicReady||!t.currentMusic.id}},[i("div",{staticClass:"music-bar-btns"},[i("i",{staticClass:"bar-icon btn-prev",attrs:{title:"上一曲 Ctrl + Left"},on:{click:t.prev}}),i("i",{staticClass:"bar-icon btn-play",class:{"btn-play-pause":t.playing},attrs:{title:"播放暂停 Ctrl + Space"},on:{click:t.play}}),i("i",{staticClass:"bar-icon btn-next",attrs:{title:"下一曲 Ctrl + Right"},on:{click:t.next}})]),i("div",{staticClass:"music-music"},[i("div",{staticClass:"music-bar-info"},[t.currentMusic&&t.currentMusic.id?[t._v("\n          "+t._s(t.currentMusic.name)+"\n          "),i("span",[t._v("- "+t._s(t.currentMusic.singer))])]:[t._v("欢迎使用mmPlayer在线音乐播放器")]],2),t.currentMusic.id?i("div",{staticClass:"music-bar-time"},[t._v(t._s(t._f("format")(t.currentTime))+"/"+t._s(t._f("format")(t.currentMusic.duration%3600)))]):t._e(),i("mm-progress",{staticClass:"music-progress",attrs:{percent:t.percentMusic,percentProgress:t.currentProgress},on:{percentChange:t.progressMusic}})],1),i("i",{staticClass:"bar-icon btn-mode",class:t.modeClass,attrs:{title:t.modeTitle},on:{click:t.modeChange}}),i("i",{staticClass:"bar-icon btn-comment",on:{click:t.openComment}}),i("div",{staticClass:"music-bar-volume",attrs:{title:"音量加减 [Ctrl+Up/Down]"}},[i("i",{staticClass:"bar-icon btn-volume",class:{"btn-volume-no":t.isMute},on:{click:t.switchMute}}),i("mm-progress",{attrs:{percent:t.volume},on:{percentChange:t.volumeChange}})],1)]),i("div",{staticClass:"mmPlayer-bg",style:{backgroundImage:t.picUrl}}),i("div",{staticClass:"mmPlayer-mask"})])},n=[],s=(i("cde0"),i("d4d5"),i("6c4c")),c=i("0108"),a=i("365c"),o=i("db49"),u={initAudio:function(t){var e=t.audioEle;e.onprogress=function(){try{if(e.buffered.length>0){var i=t.currentMusic.duration,r=0;e.buffered.end(0),r=e.buffered.end(0)>i?i:e.buffered.end(0),t.currentProgress=r/i}}catch(n){}},e.onplay=function(){var e;clearTimeout(e),e=setTimeout(function(){t.musicReady=!0},100)},e.ontimeupdate=function(){t.currentTime=e.currentTime},e.onended=function(){t.mode===o["e"].loop?t.loop():t.next()},e.onerror=function(){t.$mmToast("当前音乐不可播放，已自动播放下一曲"),t.next()},e.onstalled=function(){var i;e.load(),t.setPlaying(!1),clearTimeout(i),i=setTimeout(function(){t.setPlaying(!0)},10)},e.oncanplay=function(){0!==t.historyList.length&&t.currentMusic.id===t.historyList[0].id||t.setHistory(t.currentMusic)}}},l=u,d=i("bbd5"),m=i("591a"),h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"music-btn"},[i("div",[i("router-link",{attrs:{to:"/music/playlist",tag:"span"}},[t._v("正在播放")]),i("router-link",{attrs:{to:"/music/toplist",tag:"span"}},[t._v("推荐")]),i("router-link",{attrs:{to:"/music/search",tag:"span"}},[t._v("搜索")]),i("router-link",{attrs:{to:"/music/userlist",tag:"span"}},[t._v("我的歌单")]),i("router-link",{attrs:{to:"/music/fm",tag:"span"}},[t._v("电台")]),i("router-link",{attrs:{to:"/music/historylist",tag:"span"}},[t._v("我听过的")])],1)])},v=[],f={},p=f,g=(i("b3e4"),i("17cc")),y=Object(g["a"])(p,h,v,!1,null,"06a43742",null),b=y.exports,x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("dl",{staticClass:"music-info"},[i("dt",[i("img",{attrs:{src:t.musicPicUrl}})]),t.currentMusic.id?[i("dd",[t._v("歌曲名："+t._s(t.currentMusic.name))]),i("dd",[t._v("歌手名："+t._s(t.currentMusic.singer))]),i("dd",[t._v("专辑名："+t._s(t.currentMusic.album))])]:[i("dd",[t._v("mmPlayer在线音乐播放器")]),t._m(0)]],2),i("div",{ref:"musicLyric",staticClass:"music-lyric"},[i("div",{staticClass:"music-lyric-items",style:t.lyricTop},[t.currentMusic.id?t.nolyric?i("p",[t._v("暂无歌词！")]):t.lyric.length>0?t._l(t.lyric,function(e,r){return i("p",{key:r,class:{on:t.lyricIndex===r}},[t._v(t._s(e.text))])}):i("p",[t._v("歌词加载失败！")]):i("p",[t._v("还没有播放音乐哦！")])],2)])])},M=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("dd",[i("a",{staticClass:"github",attrs:{target:"_blank",href:"https://github.com/maomao1996"}},[t._v("茂茂")])])}],C={name:"lyric",props:{lyric:{type:Array,default:function(){return[]}},nolyric:{type:Boolean,default:!1},lyricIndex:{type:Number,default:0}},data:function(){return{top:0}},computed:Object(c["a"])({musicPicUrl:function(){return this.currentMusic.id?"".concat(this.currentMusic.image,"?param=200y200"):i("2262")},lyricTop:function(){return"transform :translate3d(0, ".concat(-34*(this.lyricIndex-this.top),"px, 0)")}},Object(m["c"])(["currentMusic"])),mounted:function(){var t=this;window.addEventListener("resize",function(){clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){return t.clacTop()},60)}),this.$nextTick(function(){return t.clacTop()})},methods:{clacTop:function(){var t=this.$refs.musicLyric.offsetHeight;this.top=Math.floor(t/34/2)}}},P=C,_=(i("4e6a"),Object(g["a"])(P,x,M,!1,null,"82d3c266",null)),w=_.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"mmProgress",staticClass:"mmProgress",on:{click:t.barClick}},[i("div",{staticClass:"mmProgress-bar"}),i("div",{ref:"mmPercentProgress",staticClass:"mmProgress-outer"}),i("div",{ref:"mmProgressInner",staticClass:"mmProgress-inner"},[i("div",{staticClass:"mmProgress-dot",on:{mousedown:t.barDown,touchstart:function(e){return e.preventDefault(),t.barDown(e)}}})])])},T=[],I=10,$={name:"mmProgress",data:function(){return{move:{status:!1,startX:0,left:0}}},props:{percent:{type:[Number],default:0},percentProgress:{type:[Number],default:0}},mounted:function(){var t=this;this.$nextTick(function(){t.bindEvents();var e=t.$refs.mmProgress.clientWidth-I,i=t.percent*e;t.moveSilde(i)})},methods:{bindEvents:function(){document.addEventListener("mousemove",this.barMove),document.addEventListener("mouseup",this.barUp),document.addEventListener("touchmove",this.barMove),document.addEventListener("touchend",this.barUp)},unbindEvents:function(){document.removeEventListener("mousemove",this.barMove),document.removeEventListener("mouseup",this.barUp),document.removeEventListener("touchmove",this.barMove),document.removeEventListener("touchend",this.barUp)},barClick:function(t){var e=this.$refs.mmProgress.getBoundingClientRect(),i=Math.min(this.$refs.mmProgress.clientWidth-I,Math.max(0,t.clientX-e.left));this.moveSilde(i),this.commitPercent()},barDown:function(t){this.move.status=!0,this.move.startX=t.clientX||t.touches[0].pageX,this.move.left=this.$refs.mmProgressInner.clientWidth},barMove:function(t){if(!this.move.status)return!1;var e=t.clientX||t.touches[0].pageX,i=e-this.move.startX,r=Math.min(this.$refs.mmProgress.clientWidth-I,Math.max(0,this.move.left+i));this.moveSilde(r),this.commitPercent()},barUp:function(t){t.stopPropagation(),this.move.status=!1},moveSilde:function(t){this.$refs.mmProgressInner.style.width="".concat(t,"px")},commitPercent:function(){var t=this.$refs.mmProgress.clientWidth-I,e=this.$refs.mmProgressInner.clientWidth/t;this.$emit("percentChange",e)}},watch:{percent:function(t){if(t>=0&&!this.move.status){var e=this.$refs.mmProgress.clientWidth-I,i=t*e;this.moveSilde(i)}},percentProgress:function(t){var e=this.$refs.mmProgress.clientWidth*t;this.$refs.mmPercentProgress.style.width="".concat(e,"px")}},beforeDestroy:function(){this.unbindEvents()}},E=$,S=(i("0908"),Object(g["a"])(E,k,T,!1,null,null,null)),L=S.exports,O={name:"music",components:{Lyric:w,MusicBtn:b,MmProgress:L},data:function(){return{musicReady:!1,currentTime:0,currentProgress:0,lyric:[],nolyric:!1,lyricIndex:0,isMute:!1,volume:1}},computed:Object(c["a"])({picUrl:function(){return this.currentMusic.id&&this.currentMusic.image?"url(".concat(this.currentMusic.image,"?param=300y300)"):"url(".concat(o["c"],")")},modeClass:function(){var t;return(t={},Object(s["a"])(t,o["e"].listLoop,"mode-listLoop"),Object(s["a"])(t,o["e"].order,"mode-order"),Object(s["a"])(t,o["e"].random,"mode-random"),Object(s["a"])(t,o["e"].loop,"mode-loop"),t)[this.mode]},modeTitle:function(){var t,e="Ctrl + O";return(t={},Object(s["a"])(t,o["e"].listLoop,"列表循环 ".concat(e)),Object(s["a"])(t,o["e"].order,"顺序播放 ".concat(e)),Object(s["a"])(t,o["e"].random,"随机播放 ".concat(e)),Object(s["a"])(t,o["e"].loop,"单曲循环 ".concat(e)),t)[this.mode]},percentMusic:function(){var t=this.currentMusic.duration;return this.currentTime&&t?this.currentTime/t:0}},Object(m["c"])(["audioEle","mode","playing","playlist","orderList","currentIndex","currentMusic","historyList"])),watch:{currentMusic:function(t,e){var i=this;t.id?t.id!==e.id&&(this.lyricIndex=this.currentTime=this.currentProgress=0,this.audioEle.play(),this.$nextTick(function(){i._getLyric(t.id)})):this.lyric=[]},playing:function(t){var e=this,i=this.audioEle;this.$nextTick(function(){t?i.play():i.pause(),e.musicReady=!0})},currentTime:function(t){if(!this.nolyric){for(var e=0,i=0;i<this.lyric.length;i++)t>this.lyric[i].time&&(e=i);this.lyricIndex=e}}},mounted:function(){var t=this;window.clv.hass.then(function(e){var i=e.attr,r=(e.isPlaying,e.isReady);t.musicReady=r,t.volume=i.volume_level||1,i.playlist.length>0&&t.$nextTick(function(){t._getLyric(i.playlist[i.index].id);var e=Math.ceil(i.media_position),r=e;setInterval(function(){window.clv.hass.then(function(i){var n=i.attr,s=i.isPlaying;if(s){var c=Math.ceil(n.media_position);e!=c?r=e=c:r+=1,t.currentTime=r}t.setCurrentIndex(n.index),t.setPlaying(s),t.setDOM()})},1e3)}),t.setDOM()}).finally(function(){t.$nextTick(function(){l.initAudio(t),t.initKeyDown()})})},methods:Object(c["a"])({setDOM:function(){try{var t=top.document.body.querySelector("home-assistant").shadowRoot.querySelector("home-assistant-main").shadowRoot.querySelector("ha-panel-lovelace").shadowRoot.querySelector("hui-root").shadowRoot.querySelector("#view hui-iframe-card").shadowRoot.querySelector("ha-card");t.style="height:calc(100vh - 112px)";var e=t.querySelector("#root");e.style="height:100%; padding-top:0;"}catch(i){}},initKeyDown:function(){var t=this;document.onkeydown=function(e){switch(e.ctrlKey&&e.keyCode){case 32:t.play();break;case 37:t.prev();break;case 38:var i=Number((t.volume+=.1).toFixed(1));i>1&&(i=1),t.volumeChange(i);break;case 39:t.next();break;case 40:var r=Number((t.volume-=.1).toFixed(1));r<0&&(r=0),t.volumeChange(r);break;case 79:t.modeChange();break}}},prev:function(){if(window.clv.exec({cmd:"prev"}),this.musicReady)if(1===this.playlist.length)this.loop();else{var t=this.currentIndex-1;t<0&&(t=this.playlist.length-1),this.setCurrentIndex(t),!this.playing&&this.musicReady&&this.setPlaying(!0)}},play:function(){window.clv.exec({cmd:this.playing?"pause":"play"}),this.musicReady&&this.setPlaying(!this.playing)},next:function(){if(window.clv.exec({cmd:"next"}),this.musicReady){if(this.playlist.length-1===this.currentIndex&&this.mode===o["e"].order)return this.setCurrentIndex(-1),void this.setPlaying(!1);if(1===this.playlist.length)this.loop();else{var t=this.currentIndex+1;t===this.playlist.length&&(t=0),!this.playing&&this.musicReady&&this.setPlaying(!0),this.setCurrentIndex(t)}}},loop:function(){this.audioEle.currentTime=0,this.audioEle.play(),this.setPlaying(!0),this.lyric.length>0&&(this.lyricIndex=0)},progressMusic:function(t){this.audioEle.currentTime=this.currentMusic.duration*t},modeChange:function(){alert("如果加上这个功能，我还要改很多代码，所以不能用")},resetCurrentIndex:function(t){var e=this,i=t.findIndex(function(t){return t.id===e.currentMusic.id});this.setCurrentIndex(i)},openComment:function(){if(!this.currentMusic.id)return this.$mmToast("还没有播放歌曲哦！"),!1;this.$router.push("/music/comment/".concat(this.currentMusic.id))},volumeChange:function(t){this.isMute=0===t,window.clv.setVolume(t),this.volume=t,this.audioEle.volume=t},switchMute:function(){var t=this.audioEle;this.isMute=!this.isMute,this.isMute?t.volume=0:t.volume=this.volume},_getLyric:function(t){var e=this;Object(a["d"])(t).then(function(t){200===t.status&&(t.data.nolyric?e.nolyric=!0:t.data.lrc?(e.nolyric=!1,e.lyric=Object(d["c"])(t.data.lrc.lyric)):(e.nolyric=!0,e.lyric=[]))})}},Object(m["d"])({setPlaying:"SET_PLAYING",setPlaylist:"SET_PLAYLIST",setCurrentIndex:"SET_CURRENTINDEX"}),{},Object(m["b"])(["setHistory","setPlayMode"])),filters:{format:d["b"]}},R=O,j=(i("1a26"),Object(g["a"])(R,r,n,!1,null,null,null));e["default"]=j.exports},bbd5:function(t,e,i){"use strict";i.d(e,"d",function(){return n}),i.d(e,"a",function(){return s}),i.d(e,"c",function(){return c}),i.d(e,"b",function(){return a});i("d4d5"),i("34a3"),i("3c6b"),i("7bc1");function r(t,e){var i=-1,r=t.length;e||(e=new Array(r));while(++i<r)e[i]=t[i];return e}var n=function(t){var e=null==t?0:t.length;if(!e)return[];var i=-1,n=e-1,s=r(t);while(++i<e){var c=i+Math.floor(Math.random()*(n-i+1)),a=s[c];s[c]=s[i],s[i]=a}return s};function s(t){return t<10?"0"+t:t}function c(t){for(var e=t.split("\n"),i=[],r=0;r<e.length;r++){var n=decodeURIComponent(e[r]),s=/\[\d*:\d*((\.|:)\d*)*\]/g,c=n.match(s);if(c)for(var a=n.replace(s,""),o=0,u=c.length;o<u;o++){var l=c[o],d=Number(String(l.match(/\[\d*/i)).slice(1)),m=Number(String(l.match(/:\d*/i)).slice(1)),h=60*d+m;""!==a&&i.push({time:h,text:a})}}return i}function a(t){var e=Math.floor(t/60),i=Math.floor(t%60);return"".concat(s(e),":").concat(s(i))}},c28c:function(t,e,i){}}]);
//# sourceMappingURL=chunk-7cd1b67f.99180159.js.map